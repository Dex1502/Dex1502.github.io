<html>
  <head>
    <meta charset="utf-8" />
  </head>

  <body>
    <h2>Инструкция</h2>
    <p>В поле "Номер блока" вводится одна цифра с номером блока, с которого мы начинаем локализовать.</p>
    <p>
      В поле "Русский" вводятся реплики из сценария. Перед каждой репликой должна быть цифра с точкой и пробел (просто копируем со сценария).
      После каждой реплики должен стоять Enter. Чтобы перейти на следующий диалог - оставляем пустую строку. Чтобы перейти на следующий блок - ставим @.
    </p>
    <p>
      Например:<br />1. Реплика 1 первого длг первого блока<br />
      2. Реплика 2 первого длг первого блока<br />
      3. Реплика 3 первого длг первого блока<br /><br />
      1. Реплика 1 второго длг первого блока<br />
      2. Реплика 2 второго длг первого блока<br />
      3. Реплика 3 второго длг первого блока<br />
      @<br />
      1. Реплика 1 первого длг второго блока<br />
      2. Реплика 2 первого длг второго блока

    </p>
    <p>Нажимаем "Start"</p>
    <p>P.S Для ce не делал отдельной настройки, просто вручную ce_ допишeте в vs code</p>

    <div style="display: flex; gap: 20px">
      <div style="display: flex; flex-direction: column">
        Номер блока:
        <input type="text" placeholder="1" id="token" />
      </div>
      <div style="display: flex; flex-direction: column">
        Русский
        <textarea rows="30" cols="30" id="rus"> </textarea>
      </div>

      <div style="display: flex; flex-direction: column">
        Вывод
        <textarea rows="30" cols="30" id="vivod"> </textarea>
      </div>
    </div>
    <button id="Start" style="width: 300px; height: 30px; margin-top: 20px">
      Start
    </button>

    <script>
      rus.value = "";
      vivod.value = "";

      document.querySelector("#Start").addEventListener("click", () => {
        let vivodP = "";
        
        const vvod = rus.value.split("\n");
        
        let engArr=[];
        let rusArr=[];

        vvod.forEach(e=>{
          if(e!="" && e!="@"){
            rusArr.push(e.slice(3).trim())
            engArr.push(transliterate(e).slice(3).trim())
          }else{
            rusArr.push(e)
            engArr.push(e)
          }
        })

        let token=parseInt(document.querySelector('#token').value)
        let dlg=1
        let repl=1
        vivodP+=`<!-- 00${token.toString()} -->\n<!-- 1 -->\n`
        rusArr.forEach((e,i)=>{
          if(e==""){
            repl=1
            dlg++
            vivodP+=`<!-- ${dlg} -->\n`
          }else if(e=="@"){
            repl=1
            dlg=1
            token++
            vivodP+=`\n<!-- 00${token.toString()} -->\n<!-- 1 -->\n`
          }else{
            vivodP+=`<Element>\n\t<Token>00${token.toString()}_dlg_${dlg}_${repl}</Token>\n\t<!-- ${e} -->\n\t<Text>test_${engArr[i]}</Text>\n</Element>\n`
            repl++
          }
        })
        vivod.value = vivodP;
      });

      function transliterate(str) {
        const translitMap = {
          А: "A",
          Б: "B",
          В: "V",
          Г: "G",
          Д: "D",
          Е: "E",
          Ё: "Yo",
          Ж: "Zh",
          З: "Z",
          И: "I",
          Й: "Y",
          К: "K",
          Л: "L",
          М: "M",
          Н: "N",
          О: "O",
          П: "P",
          Р: "R",
          С: "S",
          Т: "T",
          У: "U",
          Ф: "F",
          Х: "Kh",
          Ц: "Ts",
          Ч: "Ch",
          Ш: "Sh",
          Щ: "Shch",
          Ъ: "'",
          Ы: "Y",
          Ь: "'",
          Э: "E",
          Ю: "Yu",
          Я: "Ya",
          а: "a",
          б: "b",
          в: "v",
          г: "g",
          д: "d",
          е: "e",
          ё: "yo",
          ж: "zh",
          з: "z",
          и: "i",
          й: "y",
          к: "k",
          л: "l",
          м: "m",
          н: "n",
          о: "o",
          п: "p",
          р: "r",
          с: "s",
          т: "t",
          у: "u",
          ф: "f",
          х: "kh",
          ц: "ts",
          ч: "ch",
          ш: "sh",
          щ: "shch",
          ъ: "'",
          ы: "y",
          ь: "'",
          э: "e",
          ю: "yu",
          я: "ya",
        };

        return str
          .split("")
          .map((char) => translitMap[char] || char)
          .join("");
      }
    </script>
  </body>
</html>
